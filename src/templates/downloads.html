{% extends "layout.html" %}

{% block title %}
Download Citations
{% endblock %}

{% block body %}

<h1 class="mb-3">Download Citations</h1>

<form id="download-form" action="{{ url_for('download_selected') }}" method="POST">

  <table class="table">
    <thead>
      <tr>
        <th scope="col">Select</th>
        <th scope="col">Title</th>
        <th scope="col">Author</th>
        <th scope="col">Date</th>
      </tr>
    </thead>

    <tbody>
      {% for e in entries %}
      <tr class="table-active">
        <td>
          <input 
            class="form-check-input entry-checkbox"
            type="checkbox"
            name="selected"
            value="{{ e.id }}"
            id="chk-{{ e.id }}">
        </td>
        <td>{{ e.title }}</td>
        <td>{{ e.author }}</td>
        <td>{{ e.date }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="d-flex justify-content-center mt-3">
    <button id="download-selected-btn" type="submit" class="btn btn-success me-2" disabled>
      Download Selected
    </button>

    <a href="{{ url_for('download_bib') }}">
      <button type="button" class="btn" style="background-color: #218838; color: white;">
        Download All
      </button>
    </a>
  </div>

</form>

<script>
  const checkboxes = document.querySelectorAll('.entry-checkbox');
  const downloadBtn = document.getElementById('download-selected-btn');
  function updateButtonState() {const anyChecked = Array.from(checkboxes).some(cb => cb.checked); downloadBtn.disabled = !anyChecked;}
  checkboxes.forEach(cb => cb.addEventListener('change', updateButtonState));
  updateButtonState();
</script>

{% endblock %}
